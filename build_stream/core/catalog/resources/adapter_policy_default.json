{
  "version": "2.0.0",
  "description": "Target-centric mapping spec: pull roles into each target file, then derive common roles and remove duplicates.",
  "architectures": ["aarch64", "x86_64"],
  "targets": {
    "default_packages.json": {
      "transform": {
        "exclude_fields": ["architecture"],
        "rename_fields": {"uri": "url"}
      },
      "sources": [
        {
          "source_file": "base_os.json",
          "pulls": [
            {
              "source_key": "Base OS",
              "target_key": "default_packages",
              "filter": {
                "type": "allowlist",
                "field": "package",
                "values": ["systemd", "systemd-udev", "kernel", "dracut", "dracut-live", "dracut-network", "squashfs-tools", "nfs-utils", "nfs4-acl-tools", "NetworkManager", "nm-connection-editor", "iproute", "iputils", "curl", "bash", "coreutils", "grep", "sed", "gawk", "findutils", "util-linux", "kbd", "lsof", "cryptsetup", "lvm2", "device-mapper", "rsyslog", "chrony", "sudo", "gzip", "wget", "cloud-init", "glibc-langpack-en", "gedit", "docker.io/dellhpcomniaaisolution/image-build-aarch64", "docker.io/dellhpcomniaaisolution/image-build-el10"],
                "case_sensitive": false
              }
            }
          ]
        }
      ]
    },
    "admin_debug_packages.json": {
      "transform": {
        "exclude_fields": ["architecture"],
        "rename_fields": {"uri": "url"}
      },
      "sources": [
        {
          "source_file": "base_os.json",
          "pulls": [
            {
              "source_key": "Base OS",
              "target_key": "admin_debug_packages",
              "filter": {
                "type": "allowlist",
                "field": "package",
                "values": ["which", "tcpdump", "traceroute", "iperf3", "fping", "dmidecode", "hwloc", "hwloc-libs", "lshw", "pciutils", "vim-enhanced", "emacs", "zsh", "openssh", "openssh-server", "openssh-clients", "rsync", "file", "libcurl", "tar", "bzip2", "man-db", "man-pages", "strace", "kexec-tools", "openssl-devel", "ipmitool", "gdb", "gdb-gdbserver", "lldb", "lldb-devel", "valgrind", "valgrind-devel", "ltrace", "kernel-tools", "perf", "papi", "papi-devel", "papi-libs", "cmake", "make", "autoconf", "automake", "libtool", "gcc", "gcc-c++", "gcc-gfortran", "binutils", "binutils-devel", "clustershell", "bash-completion"],
                "case_sensitive": false
              }
            }
          ]
        }
      ]
    },
    "openldap.json": {
      "transform": {
        "exclude_fields": ["architecture"],
        "rename_fields": {"uri": "url"}
      },
      "sources": [
        {
          "source_file": "base_os.json",
          "pulls": [
            {
              "source_key": "Base OS",
              "target_key": "openldap",
              "filter": {
                "type": "allowlist",
                "field": "package",
                "values": ["openldap-clients", "nss-pam-ldapd", "sssd", "oddjob-mkhomedir", "authselect"],
                "case_sensitive": false
              }
            }
          ]
        }
      ]
    },
    "ldms.json": {
      "transform": {
        "exclude_fields": ["architecture"],
        "rename_fields": {"uri": "url"}
      },
      "sources": [
        {
          "source_file": "base_os.json",
          "pulls": [
            {
              "source_key": "Base OS",
              "target_key": "ldms",
              "filter": {
                "type": "allowlist",
                "field": "package",
                "values": ["python3-devel", "python3-cython", "openssl-libs", "ovis-ldms"],
                "case_sensitive": false
              }
            }
          ]
        }
      ]
    },
    "service_k8s.json": {
      "transform": {
        "exclude_fields": ["architecture"],
        "rename_fields": {"uri": "url"}
      },
      "sources": [
        {
          "source_file": "functional_layer.json",
          "pulls": [
            {"source_key": "service_kube_control_plane_x86_64", "target_key": "service_kube_control_plane"},
            {"source_key": "service_kube_control_plane_x86_64", "target_key": "service_kube_control_plane_first"},
            {"source_key": "service_kube_node_x86_64", "target_key": "service_kube_node"}
          ]
        }
      ],
      "derived": [
        {
          "target_key": "service_k8s",
          "operation": {
            "type": "extract_common",
            "from_keys": ["service_kube_control_plane_first", "service_kube_control_plane", "service_kube_node"],
            "min_occurrences": 3,
            "remove_from_sources": true
          }
        }
      ]
    },
    "slurm_custom.json": {
      "transform": {
        "exclude_fields": ["architecture"],
        "rename_fields": {"uri": "url"}
      },
      "sources": [
        {
          "source_file": "functional_layer.json",
          "pulls": [
            {"source_key": "slurm_control_node_x86_64", "target_key": "slurm_control_node"},
            {"source_key": "slurm_node_x86_64", "target_key": "slurm_node"},
            {"source_key": "slurm_node_aarch64", "target_key": "slurm_node"},
            {"source_key": "login_node_x86_64", "target_key": "login_node"},
            {"source_key": "login_node_aarch64", "target_key": "login_node"},
            {"source_key": "login_compiler_node_x86_64", "target_key": "login_compiler_node"},
            {"source_key": "login_compiler_node_aarch64", "target_key": "login_compiler_node"}
          ]
        }
      ],
      "derived": [
        {
          "target_key": "slurm_custom",
          "operation": {
            "type": "extract_common",
            "from_keys": ["login_node", "login_compiler_node", "slurm_control_node", "slurm_node"],
            "min_occurrences": 4,
            "remove_from_sources": true
          }
        }
      ]
    },
    "additional_packages.json": {
      "transform": {
        "exclude_fields": ["architecture"],
        "rename_fields": {"uri": "url"}
      },
      "sources": [
        {
          "source_file": "functional_layer.json",
          "pulls": [
            {"source_key": "login_node_x86_64", "target_key": "login_node"}
          ]
        }
      ]
    },
    "csi_driver_powerscale.json": {
      "transform": {
        "exclude_fields": ["architecture"],
        "rename_fields": {"uri": "url"}
      },
      "sources": [
        {
          "source_file": "base_os.json",
          "pulls": [
            {
              "source_key": "Base OS",
              "target_key": "csi_driver_powerscale",
              "filter": {
                "type": "allowlist",
                "field": "package",
                "values": ["csi-powerscale", "external-snapshotter", "helm-charts", "quay.io/dell/container-storage-modules/csi-isilon", "registry.k8s.io/sig-storage/csi-attacher", "registry.k8s.io/sig-storage/csi-provisioner", "registry.k8s.io/sig-storage/csi-snapshotter", "registry.k8s.io/sig-storage/csi-resizer", "registry.k8s.io/sig-storage/csi-node-driver-registrar", "registry.k8s.io/sig-storage/csi-external-health-monitor-controller", "quay.io/dell/container-storage-modules/dell-csi-replicator", "quay.io/dell/container-storage-modules/podmon", "quay.io/dell/container-storage-modules/csm-authorization-sidecar", "quay.io/dell/container-storage-modules/csi-metadata-retriever", "registry.k8s.io/sig-storage/snapshot-controller", "docker.io/dellemc/csm-encryption"],
                "case_sensitive": false
              }
            }
          ]
        }
      ]
    }
  }
}
