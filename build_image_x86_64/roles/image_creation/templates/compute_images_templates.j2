openchami_work_dir: "{{ openchami_work_dir }}"
{% if enable_build_stream %}
rhel_base_image: "{{ oim_node_name }}/rhel-{{ build_stream_image_key }}-{{ build_stream_job_id }}"
{% set image_name_suffix = '-' + build_stream_image_key + '-' + build_stream_job_id %}
{% else %}
rhel_base_image: "{{ oim_node_name }}/{{ rhel_x86_64_base_image_name }}"
{% set image_name_suffix = compute_image_suffix | default('') %}
{% endif %}
base_compute_image_name: "{{ item.key }}{{ image_name_suffix }}"
rhel_base_compute_image_name: "rhel-{{ item.key }}{{ image_name_suffix }}"
rhel_base_compute_image: "{{ oim_node_name }}/rhel-{{ item.key }}{{ image_name_suffix }}"
# S3 directory should stay stable (no job-id) while the filename will carry job-id via image name
s3_dir_name: "rhel-{{ item.key }}"
cluster_name: "{{ oim_node_name }}"
cluster_domain: "{{ domain_name }}"
group_name: "{{ item.key }}"
rhel_base_compute_mounts: --user 0 --privileged -v {{ oim_shared_path }}/omnia/pulp/settings/certs/pulp_webserver.crt:/etc/pki/ca-trust/source/anchors/pulp_webserver.crt:z -v {{ openchami_work_dir }}/images/{{ rhel_base_compute_image_name }}-{{ rhel_tag }}.yaml:/home/builder/config.yaml:z
image_build_name: {{ ochami_x86_64_image | join (' ') }}
rhel_base_compute_command_options: {{ ochami_base_command | join (' ') }}
minio_s3_username: "{{ minio_s3_username }}"
minio_s3_password: "{{ minio_s3_password }}"
{% set s3_prefix_suffix = '' %}
s3_prefix_suffix: "{{ s3_prefix_suffix }}"
# Override OpenCHAMI defaults to ensure correct mount path
rhel_tag: "{{ rhel_tag }}"

rhel_repos:
{% set rhel_repo = rhel_x86_64_repos %}
{% for repo in rhel_repo %}
  - { name: '{{ repo.name }}', url: '{{ repo.base_url }}', gpg: '{{ repo.gpg }}' }
{% endfor %}

base_compute_image_packages:
{% for pkg in packages %}
  - {{ pkg }}
{% endfor %}

# Commands for this role
{% set command_var = functional_group + '_compute_commands' %}
{% set commands_list = lookup('vars', command_var, default=[]) %}
base_compute_image_commands:
{% if commands_list | length > 0 %}
{% for cmd in commands_list %}
  - "{{ cmd }}"
{% endfor %}
{% else %}
  []
{% endif %}
