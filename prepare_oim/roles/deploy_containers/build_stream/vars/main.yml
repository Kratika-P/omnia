# Copyright 2026 Dell Inc. or its subsidiaries. All Rights Reserved.
#
#  Licensed under the Apache License, Version 2.0 (the "License");
#  you may not use this file except in compliance with the License.
#  You may obtain a copy of the License at
#
#      http://www.apache.org/licenses/LICENSE-2.0
#
#  Unless required by applicable law or agreed to in writing, software
#  distributed under the License is distributed on an "AS IS" BASIS,
#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
#  See the License for the specific language governing permissions and
#  limitations under the License.

---
###############################################################
# Build Stream Container Configuration
###############################################################
build_stream_container_name: "omnia_build_stream"

# OIM metadata file path (read from omnia_core container)
oim_metadata_file: "/opt/omnia/.data/oim_metadata.yml"

###############################################################
# Build Stream Image (Docker Hub)
###############################################################
build_stream_dockerhub_registry: "docker.io/pritiparate"
build_stream_image_name: "{{ build_stream_dockerhub_registry }}/omnia_build_stream"
build_stream_image_tag: "1.0"

###############################################################
# Ports & Logs
###############################################################
build_stream_port: 443
build_stream_log_dir: "{{ omnia_path }}/log/build_stream"

###############################################################
# Directory & File Modes
###############################################################
build_stream_dir_mode: "0755"

###############################################################
# SSL certificate configuration for build_stream
###############################################################
build_stream_ssl_dir: "/opt/omnia/build_stream/ssl"
build_stream_ssl_cert: "{{ build_stream_ssl_dir }}/cert.pem"
build_stream_ssl_key: "{{ build_stream_ssl_dir }}/key.pem"
build_stream_ssl_days: 365
build_stream_ssl_file_mode: "0600"

###############################################################
# Pulp certificate configuration (host-mounted copy)
###############################################################
# Cert that build_stream will verify against
build_stream_pulp_cert_host_dir: "/etc/omnia/pulp/certs"
build_stream_pulp_cert_host_path: "/etc/omnia/pulp/certs/pulp_webserver.crt"
build_stream_pulp_cert_container_path: "/etc/pulp/certs/pulp_webserver.crt"

# Cert inside pulp container (source)
pulp_container_name: "pulp"
pulp_cert_src_path: "/etc/pulp/certs/pulp_webserver.crt"

###############################################################
# Pulp server URL
# SAN = DNS:localhost, DNS:pulp, IP:172.5.0.255
# â†’ so correct base URL is https://localhost:2225
###############################################################
pulp_base_url: "https://localhost:2225"
pulp_username: "admin"
pulp_password: ""

###############################################################
# Quadlet
###############################################################
quadlet_dir: "/etc/containers/systemd"
build_stream_quadlet_path: "{{ quadlet_dir }}/{{ build_stream_container_name }}.container"
build_stream_quadlet_file_mode: "0644"

# PostgreSQL configuration (from postgres role)
postgres_user: "{{ hostvars['localhost']['postgres_user'] }}"
postgres_password: "{{ hostvars['localhost']['postgres_password'] }}"
postgres_db_name: "build_stream"


###############################################################
###############################################################
# Systemd service name generated by Quadlet
###############################################################
build_stream_service: "{{ build_stream_container_name }}.service"

###############################################################
# Health check
###############################################################
build_stream_health_endpoint: "https://localhost:{{ build_stream_port }}/health"
container_ready_wait_seconds: 5
health_check_retries: 5
health_check_delay: 10
health_check_status_code: 200

###############################################################
# Firewall configuration
###############################################################
build_stream_firewall_port: "{{ build_stream_port }}/tcp"

###############################################################
# User messages
###############################################################
build_stream_deployment_success_msg: "omnia_build_stream container deployed successfully"

build_stream_image_pull_success_msg:
  - "Successfully pulled image from Docker Hub"
  - "Image: {{ build_stream_image_name }}:{{ build_stream_image_tag }}"

build_stream_deployment_status_msg:
  - "{{ build_stream_deployment_success_msg }}"
  - "Container: {{ build_stream_container_name }}"
  - "Image: {{ build_stream_image_name }}:{{ build_stream_image_tag }}"
  - "Pulp Server: {{ pulp_base_url }}"

build_stream_container_success_msg: "The {{ build_stream_container_name }} container has been successfully deployed."

build_stream_container_failure_msg: |
  The deployment of the {{ build_stream_container_name }} container has failed.
  Please run utility/oim_cleanup.yml to clean up existing OIM resources.
  After cleanup, rerun the original playbook.
